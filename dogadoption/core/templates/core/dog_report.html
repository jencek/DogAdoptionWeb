{% extends 'core/base.html' %}
{% load render_table from django_tables2 %}

{% block content %}



<h1 class="mb-4">üêæ Dog Walk Report</h1>

<!-- Filters -->
<div class="card mb-4">
  <div class="card-header bg-light"><strong>Filters</strong></div>
  <div class="card-body">
    <form method="get" class="form-row align-items-end">
      <div class="form-group col-md-4">
        <label>Dogs</label>
        {{ filter.form.dogs }}
      </div>
      <div class="form-group col-md-2">
        <label>Status</label>
        {{ filter.form.status }}
      </div>
      <div class="form-group col-md-2">
        <label>Walked After</label>
        {{ filter.form.walk_date_after }}
      </div>
      <div class="form-group col-md-2">
        <label>Walked Before</label>
        {{ filter.form.walk_date_before }}
      </div>
      <div class="form-group col-md-2">
        <button type="submit" class="btn btn-primary btn-block">Apply</button>
      </div>
    </form>
  </div>
</div>

<!-- Table -->
<div class="card mb-4">
  <div class="card-body">
    {% render_table table %}
  </div>
</div>

<!-- Graph: Walk Counts -->
<div class="card mb-4">
  <div class="card-header bg-light"><strong>Number of Walks per Week</strong></div>
  <div class="card-body">
    <canvas id="walkCountChart"></canvas>
  </div>
</div>

<!-- Graph: Avg Minutes -->
<div class="card mb-4">
  <div class="card-header bg-light"><strong>Average Minutes per Walk (per Week)</strong></div>
  <div class="card-body">
    <canvas id="walkMinutesChart"></canvas>
  </div>
</div>


<pre style="display:none">
{{ chart_datasets_counts }}
</pre>
<pre style="display:none">
{{ chart_datasets_minutes }}
</pre>
<pre style="display:none">
{{ chart_labels }}
</pre>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const labels = {{ chart_labels|safe }};

// Walk Counts
new Chart(document.getElementById('walkCountChart').getContext('2d'), {
    type: 'line',
    data: {
        labels: labels,
        datasets: {{ chart_datasets_counts|safe }}
    },
    options: {
        responsive: true,
        plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'Walks per Week per Dog' }
        },
        scales: {
            y: { beginAtZero: true, stepSize: 1 }
        }
    }
});

// Avg Minutes
new Chart(document.getElementById('walkMinutesChart').getContext('2d'), {
    type: 'line',
    data: {
        labels: labels,
        datasets: {{ chart_datasets_minutes|safe }}
    },
    options: {
        responsive: true,
        plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'Average Minutes per Walk (per Week)' }
        },
        scales: {
            y: { beginAtZero: true }
        }
    }
});
</script>
{% endblock %}
